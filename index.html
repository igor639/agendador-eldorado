<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendador PRO - Unidade Eldorado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .status-updated { transition: background-color 0.5s; background-color: #dcfce7 !important; }
        .modal-backdrop { backdrop-filter: blur(5px); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 text-slate-800 antialiased min-h-screen">

    <div class="container mx-auto p-4 md:p-6 max-w-6xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900">Agendador PRO</h1>
            <p class="text-slate-600 mt-2">Unidade Eldorado - Central de Comando</p>
        </header>

        <!-- Abas de Navega√ß√£o -->
        <div class="mb-8 bg-white p-1 rounded-xl shadow-sm">
            <nav class="flex space-x-1" aria-label="Tabs">
                <button class="tab-btn flex-1 whitespace-nowrap py-3 px-4 font-semibold text-sm rounded-lg transition-all" data-tab="agendar">Agendar</button>
                <button class="tab-btn flex-1 whitespace-nowrap py-3 px-4 font-semibold text-sm rounded-lg transition-all" data-tab="gerenciar">Gerenciar</button>
                <button class="tab-btn flex-1 whitespace-nowrap py-3 px-4 font-semibold text-sm rounded-lg transition-all" data-tab="dashboard">Dashboard</button>
            </nav>
        </div>

        <!-- Conte√∫do Principal -->
        <main id="content-area">
            <!-- SE√á√ÉO AGENDAR -->
            <section id="agendar-section" class="tab-content space-y-6 fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-lg grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="assistant-name" class="block text-sm font-semibold text-slate-700 mb-2">Seu Nome</label>
                        <select id="assistant-name" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition">
                            <option value="">-- Escolha --</option>
                            <option value="IGOR">Igor</option>
                            <option value="DIANA">Diana</option>
                            <option value="TATIANA">Tatiana</option>
                            <option value="CAMILE">Camile</option>
                            <option value="ISABELLE">Isabelle</option>
                            <option value="WELKER">Welker</option>
                        </select>
                    </div>
                    <div>
                        <label for="location-select" class="block text-sm font-semibold text-slate-700 mb-2">Local</label>
                        <select id="location-select" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition">
                            <option value="Eldorado" selected>Eldorado</option>
                            <option value="Centro">Centro</option>
                        </select>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-xl font-semibold text-slate-900">Destinat√°rios</h2>
                        <div class="flex gap-2 w-full sm:w-auto">
                            <button id="add-recipient-btn" class="flex-1 sm:flex-none btn-indigo">+ Amanh√£</button>
                            <button id="add-puxada-btn" class="flex-1 sm:flex-none btn-amber">+ Hoje (Puxada)</button>
                        </div>
                    </div>
                    <div id="recipients-list" class="space-y-4">
                        <div id="empty-state" class="text-center py-8 border-2 border-dashed border-slate-200 rounded-lg">
                            <p class="text-slate-500">Nenhum destinat√°rio adicionado.</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3">
                    <button id="quick-message-btn" class="btn-green">üì® Mensagem R√°pida</button>
                    <button id="generate-messages-btn" class="btn-blue" disabled>üìù Gerar Mensagens Completas</button>
                </div>

                <div id="messages-section" class="bg-white p-6 rounded-2xl shadow-lg hidden">
                    <h2 class="text-xl font-semibold text-slate-900 mb-4">Mensagens Geradas</h2>
                    <div id="messages-list" class="space-y-4"></div>
                </div>
            </section>
            
            <!-- SE√á√ÉO GERENCIAR -->
            <section id="gerenciar-section" class="tab-content hidden fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold text-slate-900 mb-4">Agendamentos de Hoje</h2>
                    <p class="text-sm text-slate-600 mb-4">Selecione seu nome para ver e gerenciar os agendamentos do dia.</p>
                    <div id="management-list" class="space-y-3">
                        <div id="loader" class="text-center py-12 hidden"><div class="loader mx-auto"></div><p class="mt-4 text-slate-500">Buscando...</p></div>
                        <div id="management-empty-state" class="text-center py-12 border-2 border-dashed border-slate-200 rounded-lg hidden"><p class="text-slate-500">Nenhum agendamento encontrado para hoje.</p></div>
                    </div>
                </div>
            </section>

            <!-- SE√á√ÉO DASHBOARD -->
            <section id="dashboard-section" class="tab-content hidden fade-in">
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold text-slate-900 mb-6">Seu Desempenho Hoje</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-slate-50 p-4 rounded-xl">
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">Resumo de Status</h3>
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl">
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">Totais do Dia</h3>
                            <div id="dashboard-stats" class="space-y-2 mt-4"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para Mensagem R√°pida -->
    <div id="quick-message-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 modal-backdrop bg-black bg-opacity-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 transform transition-all">
            <h3 class="text-xl font-bold text-slate-900 mb-4">Gerar Mensagem R√°pida</h3>
            <div class="space-y-4">
                <div>
                    <label for="quick-jovem" class="block text-sm font-medium text-slate-700">Nome do Jovem</label>
                    <input type="text" id="quick-jovem" class="w-full mt-1 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="quick-numero" class="block text-sm font-medium text-slate-700">N√∫mero (com DDD)</label>
                    <input type="tel" id="quick-numero" placeholder="55319..." class="w-full mt-1 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Escolha o Template</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50">
                            <input type="radio" name="quick-template" value="variacao1" class="mr-3" checked>
                            <span class="text-sm">VARIA√á√ÉO 1 (Retorno at√© amanh√£)</span>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50">
                            <input type="radio" name="quick-template" value="variacao2" class="mr-3">
                            <span class="text-sm">VARIA√á√ÉO 2 (Retorno obrigat√≥rio)</span>
                        </label>
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50">
                            <input type="radio" name="quick-template" value="followup" class="mr-3">
                            <span class="text-sm font-semibold text-red-600">FOLLOW-UP (Prazo encerra hoje)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="quick-modal-cancel" class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition">Cancelar</button>
                <button id="quick-generate-btn" class="btn-green">Gerar e Enviar</button>
            </div>
            <div id="quick-message-result" class="mt-4 hidden"></div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // URL DO SEU APP SCRIPT DEPLOYADO COMO WEB APP
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw5p93oojhuDCgPpTII9E6jTSoO3L_2X_CxQSEWlYYoa4WTLW9TvXBs_4LDvFPS9qFp0Q/exec';

        // --- Seletores Globais ---
        const assistantSelect = document.getElementById('assistant-name');
        const locationSelect = document.getElementById('location-select');
        const addRecipientBtn = document.getElementById('add-recipient-btn');
        const addPuxadaBtn = document.getElementById('add-puxada-btn');
        const recipientsList = document.getElementById('recipients-list');
        const generateMessagesBtn = document.getElementById('generate-messages-btn');
        const messagesSection = document.getElementById('messages-section');
        const messagesList = document.getElementById('messages-list');
        const emptyState = document.getElementById('empty-state');
        const managementList = document.getElementById('management-list');
        const loader = document.getElementById('loader');
        const managementEmptyState = document.getElementById('management-empty-state');
        
        // Quick Message Modal
        const quickMessageBtn = document.getElementById('quick-message-btn');
        const quickMessageModal = document.getElementById('quick-message-modal');
        const quickModalCancel = document.getElementById('quick-modal-cancel');
        const quickGenerateBtn = document.getElementById('quick-generate-btn');
        const quickJovemInput = document.getElementById('quick-jovem');
        const quickNumeroInput = document.getElementById('quick-numero');
        const quickMessageResult = document.getElementById('quick-message-result');

        let recipients = [];
        const LOCAL_STORAGE_KEY = 'agendadorProEldoradoRascunhos';
        let statusChartInstance = null;

        // --- Classes de Bot√£o (Tailwind) ---
        const btnClasses = 'py-2 px-4 font-semibold rounded-lg shadow-md transition-all duration-300 focus:outline-none focus:ring-2';
        document.querySelectorAll('.btn-indigo').forEach(el => el.className = `${btnClasses} bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-indigo-500`);
        document.querySelectorAll('.btn-amber').forEach(el => el.className = `${btnClasses} bg-amber-500 text-white hover:bg-amber-600 focus:ring-amber-500`);
        document.querySelectorAll('.btn-green').forEach(el => el.className = `${btnClasses} bg-green-600 text-white hover:bg-green-700 focus:ring-green-500`);
        document.querySelectorAll('.btn-blue').forEach(el => el.className = `${btnClasses} bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500`);

        // --- L√≥gica de Tabs ---
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        const switchTab = (tabName) => {
            tabBtns.forEach(btn => {
                btn.classList.remove('bg-white', 'text-indigo-600', 'shadow-sm');
                btn.classList.add('text-slate-600', 'hover:text-slate-800');
            });
            tabContents.forEach(content => content.classList.add('hidden'));

            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.remove('text-slate-600', 'hover:text-slate-800');
            activeBtn.classList.add('bg-white', 'text-indigo-600', 'shadow-sm');
            
            document.getElementById(`${tabName}-section`).classList.remove('hidden');

            if (tabName === 'gerenciar') fetchAppointments();
            if (tabName === 'dashboard') fetchDashboardData();
        };

        tabBtns.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.tab)));
        switchTab('agendar'); // Inicia na primeira aba

        // --- L√≥gica de Dashboard ---
        const fetchDashboardData = async () => {
            const assistantName = assistantSelect.value;
            if (!assistantName) {
                document.getElementById('dashboard-stats').innerHTML = '<p class="text-slate-500">Selecione seu nome para ver o dashboard.</p>';
                if (statusChartInstance) statusChartInstance.destroy();
                return;
            }

            const today = new Date();
            const dateFilter = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const fetchUrl = `${SCRIPT_URL}?action=getDashboardData&assistant=${assistantName}&date=${dateFilter}`;

            try {
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.status === 'success') {
                    renderDashboard(result.data);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error("Erro ao buscar dados do dashboard:", error);
                document.getElementById('dashboard-stats').innerHTML = `<p class="text-red-600">Erro ao carregar dados.</p>`;
            }
        };

        const renderDashboard = (data) => {
            const statsContainer = document.getElementById('dashboard-stats');
            statsContainer.innerHTML = `
                <div class="flex justify-between"><span>Total de Agendamentos:</span><span class="font-bold">${data.total}</span></div>
                <div class="flex justify-between"><span>Confirmados:</span><span class="font-bold text-green-600">${data.statusCounts['CONFIRMADA'] || 0}</span></div>
                <div class="flex justify-between"><span>Cancelados:</span><span class="font-bold text-red-600">${data.statusCounts['CANCELADA'] || 0}</span></div>
                <div class="flex justify-between"><span>Pendentes:</span><span class="font-bold text-amber-600">${data.statusCounts[''] || 0}</span></div>
            `;
            
            const ctx = document.getElementById('statusChart').getContext('2d');
            if (statusChartInstance) statusChartInstance.destroy();

            statusChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data.statusCounts).map(s => s || 'Pendente'),
                    datasets: [{
                        label: 'Quantidade',
                        data: Object.values(data.statusCounts),
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.7)', // Green
                            'rgba(239, 68, 68, 0.7)',  // Red
                            'rgba(245, 158, 11, 0.7)', // Amber
                            'rgba(59, 130, 246, 0.7)', // Blue
                            'rgba(168, 85, 247, 0.7)', // Purple
                        ],
                        borderColor: [
                            'rgba(34, 197, 94, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(168, 85, 247, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        };

        // --- L√≥gica de Gerenciamento ---
        const fetchAppointments = async () => {
            const assistantName = assistantSelect.value;
            if (!assistantName) {
                managementList.innerHTML = '<p class="text-center text-slate-500 py-8">Selecione seu nome para ver os agendamentos.</p>';
                return;
            }
            loader.style.display = 'block';
            managementEmptyState.style.display = 'none';
            managementList.innerHTML = '';

            const today = new Date();
            const dateFilter = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const fetchUrl = `${SCRIPT_URL}?action=getAppointments&assistant=${assistantName}&date=${dateFilter}`;
            
            try {
                const response = await fetch(fetchUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.status === 'success') {
                    renderAppointments(result.data);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                managementList.innerHTML = `<p class="text-center text-red-600 py-8">Erro ao buscar dados: ${error.message}</p>`;
            } finally {
                loader.style.display = 'none';
            }
        };

        const renderAppointments = (appointments) => {
            managementList.innerHTML = '';
            if (appointments.length === 0) {
                managementEmptyState.style.display = 'block';
                return;
            }
            appointments.sort((a, b) => (a.horario || '').localeCompare(b.horario || ''));
            appointments.forEach(appt => {
                const apptCard = document.createElement('div');
                apptCard.className = 'p-4 border border-slate-200 rounded-lg bg-white transition-all duration-300 hover:shadow-md';
                apptCard.id = `appt-${appt.rowId}`;
                const statusOptions = ['PUXADA','SI SEM INTERESSE','CONFIRMADA','CANCELADA','REAGENDAR','J√Å VEIO','MATRICULA','CONFIRMOU E N√ÉO VEIO'];
                const selectOptions = statusOptions.map(status => `<option value="${status}" ${appt.situacao === status ? 'selected' : ''}>${status}</option>`).join('');
                apptCard.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                        <div class="flex-1">
                            <p class="font-bold text-slate-800">${appt.jovem}</p>
                            <p class="text-sm text-slate-500">Respons√°vel: ${appt.responsavel}</p>
                            <p class="text-sm text-slate-600">üìû <a href="tel:${appt.telefone_resp}" class="text-indigo-600 hover:underline">${appt.telefone_resp || 'N/D'}</a></p>
                            <div class="mt-2 text-sm text-slate-600 flex flex-wrap gap-x-4 gap-y-1">
                                <span>üóìÔ∏è ${appt.data}</span>
                                <span>‚è∞ ${appt.horario || 'N/D'}</span>
                            </div>
                        </div>
                        <select class="status-select w-full sm:w-auto p-2 border border-slate-300 rounded-md bg-slate-50 text-sm focus:ring-2 focus:ring-indigo-500" data-row-id="${appt.rowId}" data-sheet-name="${appt.sheetName}">
                            <option value="">Pendente</option>
                            ${selectOptions}
                        </select>
                    </div>
                `;
                managementList.appendChild(apptCard);
            });
        };

        const updateAppointmentStatus = async (selectElement) => {
            const rowId = selectElement.dataset.rowId;
            const sheetName = selectElement.dataset.sheetName;
            const newStatus = selectElement.value;
            const originalBg = selectElement.style.backgroundColor;
            
            selectElement.disabled = true;
            selectElement.style.backgroundColor = '#fef3c7'; // Amarelo

            try {
                const payload = { action: 'updateStatus', rowId: rowId, sheetName: sheetName, newStatus: newStatus };
                const response = await fetch(SCRIPT_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
                const result = await response.json();
                if (result.status === 'success') {
                    const card = document.getElementById(`appt-${rowId}`);
                    card.classList.add('status-updated');
                    setTimeout(() => card.classList.remove('status-updated'), 1500);
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                alert(`Erro ao atualizar status: ${error.message}`);
                selectElement.value = ''; // Reverte para o estado anterior
                selectElement.style.backgroundColor = '#fee2e2'; // Vermelho
            } finally {
                selectElement.disabled = false;
                setTimeout(() => { selectElement.style.backgroundColor = originalBg; }, 1500);
            }
        };
        
        managementList.addEventListener('change', (e) => {
            if (e.target.classList.contains('status-select')) {
                updateAppointmentStatus(e.target);
            }
        });

        // --- L√≥gica de Agendamento (Completa) ---
        const assistantFullNameMap = { 'IGOR': 'Igor Ara√∫jo de Alencar', 'DIANA': 'Diana D¬¥√Åvila Fagundes', 'TATIANA': 'Tatiana F. Moretti', 'CAMILE': 'Camile da Cruz Monteiro', 'ISABELLE': 'Isabelle', 'WELKER': 'Welker Pablo Zanetti' };
        const messageTemplates = { /* ... (mantive os templates longos, mas o foco agora √© nos r√°pidos) ... */ long: { title: `*CONVOCA√á√ÉO PARA TESTE VOCACIONAL E CADASTRAMENTO GRATUITO AO MERCADO DE TRABALHO*`, /* ... */ } };
        
        const getTodayDateString = () => { const today = new Date(); return `${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`; };
        const getTomorrowDateString = () => {
            const today = new Date();
            const tomorrow = new Date(today);
            let daysToAdd = 1;
            // Se for sexta (5) ou s√°bado (6), pula para segunda
            if (today.getDay() === 5) daysToAdd = 3; // Sexta -> Segunda
            if (today.getDay() === 6) daysToAdd = 2; // S√°bado -> Segunda
            tomorrow.setDate(today.getDate() + daysToAdd);
            return `${String(tomorrow.getDate()).padStart(2, '0')}/${String(tomorrow.getMonth() + 1).padStart(2, '0')}/${tomorrow.getFullYear()}`;
        };
        const getDayOfWeek = (dateString) => { /* ... (sem mudan√ßas) ... */ };
        const calculateAge = (birthDateString) => { /* ... (sem mudan√ßas) ... */ };
        const generateCode = (jovem) => { /* ... (sem mudan√ßas) ... */ };
        
        const saveToLocalStorage = () => { /* ... (sem mudan√ßas) ... */ };
        const loadFromLocalStorage = () => { /* ... (sem mudan√ßas) ... */ };
        const renderRecipients = () => { /* ... (sem mudan√ßas) ... */ };
        const createRecipientForm = (recipient, index) => { /* ... (sem mudan√ßas) ... */ };
        const renderMessages = (generatedMessages) => { /* ... (sem mudan√ßas) ... */ };
        const handleAddRecipient = () => { /* ... (sem mudan√ßas) ... */ };
        const handleAddPuxada = () => { /* ... (sem mudan√ßas) ... */ };
        const handleRemoveRecipient = (id) => { /* ... (sem mudan√ßas) ... */ };
        const handleUpdateRecipient = (id, field, value) => { /* ... (sem mudan√ßas) ... */ };
        const handleGenerateMessages = () => { /* ... (sem mudan√ßas) ... */ };
        const generateMessageText = (data) => { /* ... (sem mudan√ßas) ... */ };
        const handleSaveToSheet = async (button) => { /* ... (sem mudan√ßas) ... */ };
        const updateGenerateButtonState = () => { generateMessagesBtn.disabled = (assistantSelect.value === '' || recipients.length === 0); };

        // --- L√≥gica de Mensagem R√°pida ---
        const quickMessageTemplates = {
            variacao1: (jovem) => `CRESCER | Departamento de Orienta√ß√£o Profissional\n\nRef.: ${jovem}\n\nCadastro liberado para atendimento em:\n\nüìå Teste Vocacional (mapeamento de aptid√µes)\nüìå Cadastramento em base curricular regional\n\nAgendamento: retornar esta liga√ß√£o\nHor√°rio: 9h √†s 17h (dias √∫teis)\n\n‚ö†Ô∏è Prazo: at√© amanh√£\n\nInforma√ß√µes apenas por contato telef√¥nico.\n\nAtt, Equipe de Cadastramento`,
            variacao2: (jovem) => `CRESCER | Departamento de Orienta√ß√£o Profissional\n\nRef.: ${jovem}\n\nCadastro liberado para:\n\nüìå Teste Vocacional (mapeamento de aptid√µes)\nüìå Cadastramento em base curricular regional\n\nüîî Retorno obrigat√≥rio para agendamento\nRetornar liga√ß√£o neste contato\nHor√°rio: 9h √†s 17h\n\n‚ö†Ô∏è Prazo: amanh√£\n\nN√£o responder por mensagem - apenas liga√ß√£o.\n\nEquipe de Cadastramento`,
            followup: (jovem) => `‚ö†Ô∏è CRESCER - Lembrete Urgente\n\nRef.: ${jovem}\n\nPrazo de confirma√ß√£o encerra HOJE √†s 17h.\n\nTeste Vocacional + Cadastramento aguardando agendamento.\n\nRetornar esta liga√ß√£o.\n\nAp√≥s 17h, cadastro retorna √† lista de espera.\n\n√öltima chamada.`
        };

        quickMessageBtn.addEventListener('click', () => quickMessageModal.style.display = 'flex');
        quickModalCancel.addEventListener('click', () => {
            quickMessageModal.style.display = 'none';
            quickMessageResult.classList.add('hidden');
        });

        quickGenerateBtn.addEventListener('click', () => {
            const jovem = quickJovemInput.value.trim();
            const numero = quickNumeroInput.value.trim();
            const templateType = document.querySelector('input[name="quick-template"]:checked').value;

            if (!jovem || !numero) {
                alert('Por favor, preencha o nome e o n√∫mero.');
                return;
            }
            
            const message = quickMessageTemplates[templateType](jovem);
            const encodedMessage = encodeURIComponent(message);
            
            quickMessageResult.innerHTML = `
                <p class="font-semibold mb-2">Mensagem gerada para ${jovem}:</p>
                <pre class="whitespace-pre-wrap bg-slate-100 p-3 rounded text-sm mb-3">${message}</pre>
                <a href="https://wa.me/${numero.replace(/\D/g, '')}?text=${encodedMessage}" target="_blank" class="btn-green w-full text-center">Enviar no WhatsApp</a>
            `;
            quickMessageResult.classList.remove('hidden');
        });
        
        // --- INICIALIZA√á√ÉO ---
        addRecipientBtn.addEventListener('click', handleAddRecipient);
        addPuxadaBtn.addEventListener('click', handleAddPuxada);
        recipientsList.addEventListener('click', (e) => { if (e.target.closest('.remove-recipient-btn')) handleRemoveRecipient(e.target.closest('.remove-recipient-btn').dataset.id); });
        recipientsList.addEventListener('input', (e) => e.target.dataset.field && handleUpdateRecipient(e.target.closest('[data-id]').dataset.id, e.target.dataset.field, e.target.value));
        generateMessagesBtn.addEventListener('click', handleGenerateMessages);
        messagesList.addEventListener('click', (e) => e.target.closest('.save-btn') && handleSaveToSheet(e.target.closest('.save-btn')));
        assistantSelect.addEventListener('change', () => {
            updateGenerateButtonState();
            // Se estiver nas abas que dependem do assistente, atualiza
            if (document.getElementById('gerenciar-section').classList.contains('hidden') === false) fetchAppointments();
            if (document.getElementById('dashboard-section').classList.contains('hidden') === false) fetchDashboardData();
        });
        
        loadFromLocalStorage();
        renderRecipients();
        updateGenerateButtonState();
    });
    </script>
</body>
</html>
